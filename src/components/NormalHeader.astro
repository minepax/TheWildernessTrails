---
import fetchArticles from "../lib/fetchArticles";
import { formatCategoryName } from "../lib/utils";

const articles = await fetchArticles({ collection:"all-articles" });
const uniqueCategories = [...new Set(articles.map(article => article.category))].sort();

// 1. Vercel-CDN-Cache-Control: Tells Vercel's private cache NO CACHING. (Highest Priority)
Astro.response.headers.set(
  'Vercel-CDN-Cache-Control', 
  'no-cache, no-store' 
);

// 2. CDN-Cache-Control: Tells other CDNs and browsers NO CACHING. (Second Priority)
Astro.response.headers.set(
  'CDN-Cache-Control', 
  'no-cache, no-store' 
);

// We can still include the standard one for good measure:
Astro.response.headers.set(
  'Cache-Control', 
  'no-cache, no-store, max-age=0, must-revalidate'
);

---

<header class="header">
    <div class="wrapper">

        <nav class="header-nav" aria-label="Header navigation">
            <ul class="nav-list">
                <li><a href="/">Home</a></li>
                {uniqueCategories.map((category) => (
                    <li>
                        <a href={`/articles/${category}`}>{formatCategoryName(category)}</a>
                    </li>
                ))}
            </ul>
        </nav>
    
        <button class="hamburger-menu">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                <path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/>
            </svg>
        </button>

    </div>
</header>

<style>

.header {
    position: sticky;
    top: 0;
    left: 0;
    z-index: 100;
    box-shadow: var(--shadow);
    background-color: hsl(from var(--clr-primary-surface) h s 8% / 0.7);
    backdrop-filter: blur(10px);

    .wrapper {
        height: 4.5rem;
        padding-block: 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 2rem;
        opacity: 1;
    }
}

.header .header-nav .nav-list {
    list-style-type: none;
    display: flex;
    gap: 2rem;

    a {
        font-weight: 600;
        font-family: monospace;
        text-decoration: none;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--clr-accent-2);
        transition: color 0.4s ease;

        &:hover {
            color: var(--clr-secondary);
        }
    }
}

.hamburger-menu {
    cursor: pointer;
    border: none;
    background-color: transparent;

    svg {
        width: clamp(2.5rem, 1vw  + 0.5rem, 3rem);
        fill: var(--clr-accent-2);
        transition: fill 0.5s ease;

        &:hover {
            fill: var(--clr-secondary);
        }
    }
}

</style>